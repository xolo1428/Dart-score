<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Dart Scoring Tracker</title>
  <style>
    canvas { border: 1px solid #ccc; touch-action: none; }
    #controls { margin-top: 10px; }
  </style>
</head>
<body>
  <h2>Dart Score Tracker 🎯</h2>
  <canvas id="dartboard" width="300" height="300"></canvas>
  <div id="controls">
    <button onclick="addRound()">➕ Add Round</button>
    <button onclick="removeRound()">➖ Remove Round</button>
    <div>Total Score: <span id="totalScore">0</span></div>
  </div>
  <script src="app.js"></script>
</body>
</html>

const canvas = document.getElementById("dartboard");
const ctx = canvas.getContext("2d");
const scoreDisplay = document.getElementById("totalScore");

let rounds = [];
let hitMap = {};  // 統計每格命中次數

function drawBoard() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  let center = { x: canvas.width / 2, y: canvas.height / 2 };
  let radii = [20, 40, 60, 80, 100, 120, 140];
  let scores = [50, 25, 20, 15, 10, 5, 1];
  for (let i = radii.length - 1; i >= 0; i--) {
    let shade = 255 - (hitMap[scores[i]] || 0) * 20;
    ctx.fillStyle = `rgb(${shade}, ${shade}, ${shade})`;
    ctx.beginPath();
    ctx.arc(center.x, center.y, radii[i], 0, Math.PI * 2);
    ctx.fill();
  }
}

canvas.addEventListener("click", function (event) {
  const rect = canvas.getBoundingClientRect();
  const x = event.clientX - rect.left;
  const y = event.clientY - rect.top;
  const center = { x: canvas.width / 2, y: canvas.height / 2 };
  const dx = x - center.x;
  const dy = y - center.y;
  const dist = Math.sqrt(dx * dx + dy * dy);

  let score = 0;
  if (dist <= 20) score = 50;
  else if (dist <= 40) score = 25;
  else if (dist <= 60) score = 20;
  else if (dist <= 80) score = 15;
  else if (dist <= 100) score = 10;
  else if (dist <= 120) score = 5;
  else if (dist <= 140) score = 1;

  // 登記分數
  if (!rounds.length) addRound();
  rounds[rounds.length - 1].push(score);

  // 更新統計
  hitMap[score] = (hitMap[score] || 0) + 1;

  updateUI();
});

function updateUI() {
  drawBoard();
  const total = rounds.flat().reduce((a, b) => a + b, 0);
  scoreDisplay.textContent = total;
}

function addRound() {
  rounds.push([]);
  updateUI();
}

function removeRound() {
  if (rounds.length > 0) {
    let removed = rounds.pop();
    for (let score of removed) {
      hitMap[score] = Math.max(0, (hitMap[score] || 0) - 1);
    }
    updateUI();
  }
}